<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title> Address page </title>
        <link rel="stylesheet" href="../../assets/css/address.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Kreon:wght@300;400;500;600;700&family=Kumbh+Sans:wght@100;200;300;400;500;600;700;800;900&family=Parisienne&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    </head>
    
    <body>
        <header id="userLogin">

        </header>

        <div class="arrows"></div> 

        <a href="../homepage/addressForm.html">
         <button class="add"> ADD ADDRESS </button>
        </a>

        <div class="container">
            <!-- <div class ="address">
            <h3> DEFAULT ADDRESS : </h3>
                <p> qwertyuiop kjhgfdsadfgh </p>
            </div> -->
        </div>

        <section>

        <!-- <div class="add_card">
           <h6> Address : 1 </h6> 
           <p> qwertyui asdfghjk ewrtyuiop </p>
           <button class="set"> SET AS DEFAULT </button>
        </div> -->

    </section>

        <footer>
            <div class="top">
                <div class="about">
                    <h4> About: </h4>
                    <div class="us">
                        <p>
                          <a href="../homepage/aboutus.html"> About us </a>
                        </p> 
                        <p>
                          <a href="#"> Available Products </a>
                        </p>
                        <p>
                          <a href="#"> Security </a>
                        </p> 
                        <p>
                          <a href="../homepage/termsofuse.html"> Terms of use </a> 
                        </p> 
                        <p>
                          <a href="../homepage/return.html"> Return policy </a>
                        </p> 
           </div>
          </div>

                                            <div class="line"></div>

                                            <div class="contact">  
                 
                                                <div class="socials">
                                                    <span class="con"> Contact us: </span>
                                                    <div class="insta">
                                                        <i class="fa-brands fa-instagram"></i> 
                                                    </div>
                                                    <div class="fb">
                                                        <i class="fa-brands fa-facebook-f"></i> 
                                                    </div>
                                                    <div class="twiter">
                                                        <i class="fa-brands fa-twitter"></i> 
                                                    </div>
                                                    <div class="wa">
                                                        <i class="fa-brands fa-whatsapp"></i> 
                                                    </div>
                                                </div>
                                                <div>
                                                    <p>Copy rights @ 2022</p>
                                                </div>
                                            </div> 
       </div>

       </footer>    
<script src="../../assets/js/header.js"> </script>

<script>
// <div class = "arrow" > </div>

const div_arrow = document.createElement("div");
div_arrow.setAttribute("class", "arrow");
// console.log(div_arrow);

// <a> link </a>

const a_arrow = document.createElement("a");
a_arrow.setAttribute("href", "../homepage/frontpage.html");
div_arrow.append(a_arrow);
// console.log(a_arrow);

// < i >  arrow </i>

const i_arrow = document.createElement("i");
i_arrow.setAttribute("class", "fa-solid fa-arrow-left");
i_arrow.setAttribute("title", "Back");
a_arrow.append(i_arrow);

document.querySelector("div.arrows").append(div_arrow);

const unique_id = JSON.parse(localStorage.getItem("uniqueID"))
const user_list = JSON.parse(localStorage.getItem("user_cred"));

const check = user_list.find((t) => t.phonenumber === unique_id);
// console.log(check);

const addres = document.createElement("div");
addres.setAttribute("class", "address");

const loc = document.createElement("i");
loc.setAttribute("class", "fa-sharp fa-solid fa-location-dot");
loc.setAttribute("style", "font-size:25px; margin-top:2rem; margin-left:3rem")
loc.setAttribute("title", "Location");
addres.append(loc);

const h3 = document.createElement("h3");
h3.innerText = "DEFAULT ADDRESS :";
addres.append(h3);

const p_add = document.createElement("p");
p_add.setAttribute("id", "address");
p_add.innerText = check.address;
addres.append(p_add);
// console.log(p_add.innerText);

const p_code = document.createElement("p");
p_code.setAttribute("id", "code");
p_code.innerText = check.pincode;
addres.append(p_code);

const p_states = document.createElement("p");
p_states.setAttribute("id", "states");
p_states.innerText = check.state;
addres.append(p_states);

document.querySelector("div.container").append(addres);

const add_list = JSON.parse(localStorage.getItem("address_list"));

const addressess = add_list.filter((t) => t.buyer_id === unique_id)
console.log(addressess);

for (let i = 0; i < addressess.length; i++) {

const div_card = document.createElement("div");
div_card.setAttribute("class", "add_card");

const edit = document.createElement("i");
edit.setAttribute("id", "edit");
edit.setAttribute("title", "Edit");
edit.setAttribute("class", "fa-solid fa-pencil");
edit.setAttribute("style", "color: black; font-size:18px; margin-top:1rem; margin-left:1rem; cursor:pointer");
edit.setAttribute("data-id", addressess[i].address_id)
div_card.append(edit);

const remove = document.createElement("i");
remove.setAttribute("id", "remove");
remove.setAttribute("title", "Remove");
remove.setAttribute("class", "fa-solid fa-xmark");
remove.setAttribute("style", "color: red; font-size:18px; margin-top:1rem; margin-left:16rem; cursor:pointer");
remove.setAttribute("data-id", addressess[i].address_id)
div_card.append(remove);

const h6 = document.createElement("h6");
h6.setAttribute("class", "heading");
h6.innerText = "ADDRESS : "
div_card.append(h6);

const detail = document.createElement("div");
detail.setAttribute("class", "detail");
div_card.append(detail);

const names = document.createElement("p");
names.innerText = addressess[i].uname;
detail.append(names);

const p_address = document.createElement("p");
p_address.innerText = addressess[i].address;
detail.append(p_address);

const p_pin = document.createElement("p");
p_pin.innerText = `Pincode : ${ addressess[i].pincode}`;
detail.append(p_pin);

const p_state = document.createElement("p");
p_state.innerText = `State : ${ addressess[i].state}`;
detail.append(p_state);

const set = document.createElement("button");
set.setAttribute("class", "set");
set.setAttribute("data-id", addressess[i].address_id)
set.innerText = "SET AS DEFAULT";
div_card.append(set);

document.querySelector("section").append(div_card);
}

document.querySelectorAll("i#edit").forEach((editing) => {
    editing.addEventListener("click", (e) => {
        const add_id = e.currentTarget.dataset.id;
        console.log(add_id);
        localStorage.setItem("addressID", JSON.stringify(add_id));
        window.location.href = `../homepage/addressForm.html?address_id=${add_id}`;
    })
})

document.querySelectorAll("i#remove").forEach((remove) => {
    remove.addEventListener("click", (e) => {
        const add_id = e.currentTarget.dataset.id;
        console.log(add_id);
        localStorage.setItem("addressID", JSON.stringify(add_id));
        if(window.confirm("Are you sure to delete this address?")) {
            const card = add_list.find((r) => r.address_id === add_id && r.buyer_id === unique_id);
            const index =  add_list.indexOf(card);
            console.log(index);
            add_list.splice(index, 1);
            localStorage.setItem("address_list", JSON.stringify(add_list));
            window.location.reload();
        }
    })
})

document.querySelectorAll("button.set").forEach((defalt) => {
    defalt.addEventListener("click", (e) => {
        const add_id = e.currentTarget.dataset.id;
        console.log(add_id);
        localStorage.setItem("addressID", JSON.stringify(add_id));
        if(window.confirm("Are you sure to make this address as default?")) {
            const card = add_list.find((r) => r.address_id === add_id && r.buyer_id === unique_id);

                h3.innerText = "DEFAULT ADDRESS :";

                p_add.innerText = card.address;

                p_code.innerText = card.pincode;

                p_states.innerText = card.state;

                localStorage.setItem("default_address", JSON.stringify(card));
                console.log(localStorage.getItem("default_address"));
        }
    })
})
</script>

</body>

</html>