<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title> Add to cart page </title>
        <link rel="stylesheet" href="../../assets/css/style-cartpage.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Kreon:wght@300;400;500;600;700&family=Kumbh+Sans:wght@100;200;300;400;500;600;700;800;900&family=Parisienne&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    </head>
    
    <body>
        <header id="userLogin">

        </header>

        <div class="arrows"></div>

        <section>

        </section>

        <footer>
            <div class="top">
                <div class="about">
                    <h4> About: </h4>
                    <div class="us">
                        <p>
                          <a href="../homepage/aboutus.html"> About us </a>
                        </p> 
                        <p>
                          <a href="#"> Available Products </a>
                        </p>
                        <p>
                          <a href="#"> Security </a>
                        </p> 
                        <p>
                          <a href="../homepage/termsofuse.html"> Terms of use </a> 
                        </p> 
                        <p>
                          <a href="../homepage/return.html"> Return policy </a>
                        </p> 
           </div>
          </div>

                                            <div class="line"></div>

                                            <div class="contact">  
                 
                                                <div class="socials">
                                                    <span class="con"> Contact us: </span>
                                                    <div class="insta">
                                                        <i class="fa-brands fa-instagram"></i> 
                                                    </div>
                                                    <div class="fb">
                                                        <i class="fa-brands fa-facebook-f"></i> 
                                                    </div>
                                                    <div class="twiter">
                                                        <i class="fa-brands fa-twitter"></i> 
                                                    </div>
                                                    <div class="wa">
                                                        <i class="fa-brands fa-whatsapp"></i> 
                                                    </div>
                                                </div>
                                                <div>
                                                    <p>Copy rights @ 2022</p>
                                                </div>
                                            </div> 
       </div>

       </footer>    
<script src="../../assets/js/header.js"> </script>

<script>
// <div class = "arrow" > </div>

const div_arrow = document.createElement("div");
div_arrow.setAttribute("class", "arrow");

const a_arrow = document.createElement("a");
a_arrow.setAttribute("href", "../homepage/frontpage.html");
div_arrow.append(a_arrow);

const i_arrow = document.createElement("i");
i_arrow.setAttribute("title", "Back");
i_arrow.setAttribute("class", "fa-solid fa-arrow-left");
a_arrow.append(i_arrow);

document.querySelector("div.arrows").append(div_arrow);

const add_to_cart = JSON.parse(localStorage.getItem("cart"));

const unique_id = JSON.parse(localStorage.getItem("uniqueID"));

const check_pdt = add_to_cart.filter((e) => e.buyer_id === unique_id);
// console.log(check_pdt)

const all = JSON.parse(localStorage.getItem("product_details"));

// const match_pdt = check_pdt.forEach

// const match_pdt = all.filter((product) => check_pdt.some((id) => id.product_id === product.product_uuid));
// console.log(match_pdt);

////   No products

if (check_pdt.length === 0) {

  // <div class = products >

  const div_container = document.createElement("div");
  div_container.setAttribute("class", "contain");

  // <div class="details"></div>

  const div_details = document.createElement("div");
  div_details.setAttribute("class", "details");
  div_container.append(div_details);

  const h3_title = document.createElement("h3");
  h3_title.setAttribute("class", "not");
  h3_title.innerText = "You have not added any products yet";
  div_details.append(h3_title);

  const button = document.createElement("button");
  button.setAttribute("class", "add");
  button.innerText = "ADD PRODUCTS";
  div_container.append(button);

  document.querySelector("section").append(div_container);

  // add products

document.querySelector("button.add").addEventListener("click",() => {
  window.location.href = "../products/tc.html";
})

} 

////   showing  products   //// 

else {

for (let k = 0; k < check_pdt.length; k++) {

  const match_pdt = all.find((id) => id.product_uuid === check_pdt[k].product_id);
console.log(match_pdt);

  const size_list = JSON.parse(localStorage.getItem("product_size_details"));
 
  const ck_size = size_list.find((o) => o.product_uuid === check_pdt[k].product_id && o.size === check_pdt[k].size)

  // <div class = products >

  const div_container = document.createElement("div");
  div_container.setAttribute("class", "container");

  // <img>

  const img = document.createElement("img");
  img.setAttribute("src", match_pdt.image);
  img.setAttribute("alt", "photo");
  img.setAttribute("height", "200px");
  img.setAttribute("width", "180px");
  div_container.append(img);

  // <div class="details"></div>

  const div_details = document.createElement("div");
  div_details.setAttribute("class", "details");
  div_container.append(div_details);

  // <h3> </h3>

  const h3_title = document.createElement("h3");
  h3_title.setAttribute("id", "name");
  h3_title.innerText = match_pdt.name;
  div_details.append(h3_title);

  // <div> </div>

  const div = document.createElement("div");
  h3_title.append(div);

  // <p> </p>

  const p_org = document.createElement("p");
  p_org.setAttribute("id", "original_price");
  p_org.innerText = `₹${check_pdt[k].discount_price}`;
  div.append(p_org);

  // <s> </s>

  const s = document.createElement("s");
  s.setAttribute("id", "discount_price");
  s.innerText = `₹${ck_size.original_price}`;
  div.append(s);

  // <span> </span>

  const span = document.createElement("span");
  span.setAttribute("class", "percent");
  span.innerText = `${ck_size.discount_percent}%off`;
  div.append(span);


  const div_size = document.createElement("div");
  div.append(div_size);

    // <p> </p>

    const p_size = document.createElement("p");
  p_size.setAttribute("class", "size");
  p_size.innerText = "Size : " + check_pdt[k].size;
  div.append(p_size);

  if (check_pdt[k].size === "0" || check_pdt[k].size === "1" || check_pdt[k].size === "2" ||
  check_pdt[k].size === "3" || check_pdt[k].size === "4" || check_pdt[k].size === "5" || 
  check_pdt[k].size === "6" || check_pdt[k].size === "7") {

    p_size.setAttribute("style", "display: none");

  }

  else {

    p_size.setAttribute("style", "display: flex");

  }

  // < div class = "quantity" > </div>

  const div_quantity = document.createElement("div");
  div.append(div_quantity);

  // <p> </p>

  const p_qty = document.createElement("p");
  // p_qty.setAttribute("class", "quantities");
  p_qty.innerText = "Quantity  ";
  div.append(p_qty);

  // <input>

  const input = document.createElement("input");
  input.setAttribute("class", "quantity");
  input.setAttribute("type", "number");
  input.setAttribute("value", check_pdt[k].product_quantity);
  input.setAttribute("id", "product_quantity");
  input.setAttribute("min", "1");
  input.setAttribute("max", "10");
  input.setAttribute("data-remove", check_pdt[k].product_id);
  input.setAttribute("data-size", check_pdt[k].size)
  p_qty.append(input);

  // < button class = "remove" > </button>

  const button_remove = document.createElement("button");
  button_remove.setAttribute("class", "remove");
  button_remove.setAttribute("data-remove", check_pdt[k].product_id);
  button_remove.setAttribute("type", "submit");
  button_remove.innerText = "REMOVE";
  div_container.append(button_remove);

  const button_wish = document.createElement("button");
  button_wish.setAttribute("class", "wish");
  button_wish.setAttribute("data-remove", check_pdt[k].product_id);
  button_wish.setAttribute("type", "submit");
  button_wish.innerText = "WISHLIST";
  div_container.append(button_wish);

  document.querySelector("section").append(div_container);
}

}

// let sum = check_pdt;

let total = 0;

for (let l = 0; l < check_pdt.length; l++) {
  total += check_pdt[l].discount_price * check_pdt[l].product_quantity;
}

console.log(total);

if (check_pdt.length === 0) {
  const div_total = document.createElement("div");
  div_total.setAttribute("class", "total");
  div_total.setAttribute("style", "display: none");

// <div></div>

const div_price = document.createElement("div");
div_total.append(div_price);

const summary = document.createElement("p");
summary.innerText = "SUMMARY :";
div_price.append(summary);

// <p>

const p_sub = document.createElement("p");
p_sub.innerText = "SUB TOTAL :";
div_price.append(p_sub);

// <p>

const p_del = document.createElement("p");
p_del.innerText = "DELIVERY CHARGE :";
p_sub.append(p_del);

// <p>

const p_t_a = document.createElement("p");
p_t_a.innerText = "TOTAL AMOUNT :";
p_del.append(p_t_a);

//  <div> <div>

const div_amt = document.createElement("div");
div_total.append(div_amt);

// <p>

let p_amt = document.createElement("p");
p_amt.innerText = `₹  ${total}`;
div_amt.append(p_amt);

// <p>

const p_free = document.createElement("p");
p_free.innerText = "FREE";
p_amt.append(p_free);

// <p>

p_amt = document.createElement("p");
p_amt.setAttribute("class", "total_amt");
p_amt.innerText = `₹  ${total}`;
p_free.append(p_amt);

// <div>

const div_btn = document.createElement("div");
div_total.append(div_btn);

// < button class = "buy" > </button>

const button_buy = document.createElement("button");
button_buy.setAttribute("class", "buy");
button_buy.innerText = "BUY NOW";
div_btn.append(button_buy);

document.querySelector("section").append(div_total);
}
else {
  const div_total = document.createElement("div");
  div_total.setAttribute("class", "total");
  
const div = document.createElement("div");
div.setAttribute("class", "sum");
div_total.append(div)

const summary = document.createElement("p");
summary.innerText = "SUMMARY :";
div.append(summary);

// <div>

const div_price = document.createElement("div");
div_price.setAttribute("class", "sub");
div_total.append(div_price);

// <p>

const p_sub = document.createElement("p");
p_sub.innerText = "SUB TOTAL :";
div_price.append(p_sub);

// <p>

const p_del = document.createElement("p");
p_del.innerText = "DELIVERY CHARGE :";
p_sub.append(p_del);

// <p>

const p_t_a = document.createElement("p");
p_t_a.innerText = "TOTAL AMOUNT :";
p_del.append(p_t_a);

//  <div> <div>

const div_amt = document.createElement("div");
div_amt.setAttribute("class", "amt");
div_total.append(div_amt);

// <p>

let p_amt = document.createElement("p");
p_amt.innerText = `₹  ${total}`;
div_amt.append(p_amt);

// <p>

const p_free = document.createElement("p");
p_free.innerText = "FREE";
p_amt.append(p_free);

// <p>

p_amt = document.createElement("p");
p_amt.setAttribute("class", "total_amt");
p_amt.innerText = `₹  ${total}`;
p_free.append(p_amt);

// <div>

const div_btn = document.createElement("div");
div_total.append(div_btn);

// < button class = "buy" > </button>

const button_buy = document.createElement("button");
button_buy.setAttribute("class", "buy");
button_buy.innerText = "BUY NOW";
div_btn.append(button_buy);

document.querySelector("section").append(div_total);
}

const div_back = document.createElement("div");
div_back.setAttribute("class", "back");

const div_row = document.createElement("div");
div_row.setAttribute("class", "row");
div_back.append(div_row);

const loc = document.createElement("i");
loc.setAttribute("class", "fa-sharp fa-solid fa-location-dot");
loc.setAttribute("style", "font-size:25px; margin-top:2rem; margin-left:-2rem")
loc.setAttribute("title", "Location");
div_row.append(loc);

const addresses = document.createElement("b");
addresses.setAttribute("class", "address");
addresses.setAttribute("style", "margin-top:-1.7rem")
addresses.innerText = "Delivery Address : "
div_row.append(addresses);

const users = JSON.parse(localStorage.getItem("default_address")) || {}; 
const user_list = JSON.parse(localStorage.getItem("address_list")) || [];

const check_add = user_list.find((f) => f.address === users.address);

const addr = document.createElement("p");
addr.setAttribute("class", "address");
div_row.append(addr);

const pin = document.createElement("p");
pin.setAttribute("class", "address");
div_row.append(pin);

const state = document.createElement("p");
state.setAttribute("class", "address");
div_row.append(state);

const change = document.createElement("button");
change.setAttribute("class", "change")
div_back.append(change);

if(check_add){
addr.innerText = check_add.address;
pin.innerText = check_add.pincode;
state.innerText = check_add.state;
change.innerText = "Change";
}

if(!check_add){
  const user_cred = JSON.parse(localStorage.getItem("user_cred"));
  const user = user_cred.find((e) => e.phonenumber === unique_id);
addr.innerText = user.address;
pin.innerText = user.pincode;
state.innerText = user.state;
change.innerText = "Change";
}

document.querySelector("section").append(div_back);

document.querySelector("button.change").addEventListener("click", () => {
  window.location.href = "../homepage/address.html";
})


/////    QUANTITY INCREASE OR DECREASE FUNCTION   //////


const product_quantity = document.querySelectorAll(".quantity");

product_quantity.forEach((add) => {
  add.addEventListener("change", (e) => {
    const productId = e.currentTarget.dataset.remove;

    localStorage.setItem("product_id", JSON.stringify(productId));

    const productid = JSON.parse(localStorage.getItem("product_id"));

    const all_products = JSON.parse(localStorage.getItem("cart"));

    const parent = e.currentTarget.closest(".container");

    const qauntity = parent.querySelector(".quantity").value;

    if (qauntity > 11) {
      
      alert("Only 10 items can be ordered at a time.")
    
    }

    else {

      const size_0f_pdt = parent.querySelector(".size").innerText;
    console.log(size_0f_pdt);

    
    const parts = size_0f_pdt.split(":");

    const key = parts[0].trim();
  const value = parts[1].trim();

    const pdts = all_products.find(
      (a) => a.product_id === productid && a.buyer_id === unique_id && a.size === value
    );
    console.log(pdts);

    let ogPrice = pdts.discount_price;

    const cartPrice = ogPrice * qauntity;

    ogPrice = cartPrice;

    pdts.product_quantity = qauntity;

    localStorage.setItem("cart", JSON.stringify(all_products));

    window.location.reload();

    }

  });
});

// function remove_pdt () {

const products = document.querySelectorAll("button.remove");

products.forEach((check) => {
  check.addEventListener("click", (e) => {
    const product_id = e.currentTarget.dataset.remove;

    localStorage.setItem("products_id", JSON.stringify(product_id));

    if (window.confirm("Are you sure to remove this product?")) {
      const id = JSON.parse(localStorage.getItem("products_id"));

      const all_products = JSON.parse(localStorage.getItem("cart"));

      const pdts = all_products.find(
        (f) => f.product_id === id && f.buyer_id === unique_id
      );

      const indexOfProduct = all_products.indexOf(pdts);

      all_products.splice(indexOfProduct, 1);

      const cart_count = JSON.parse(localStorage.getItem("cart_count"));

      const cart_length = cart_count-1;

      localStorage.setItem("cart_count", JSON.stringify(cart_length));

      localStorage.setItem("cart", JSON.stringify(all_products));
    }

    window.location.reload();
  });
});

// MOVE TO WISHLIST
  
const product = document.querySelectorAll("button.wish");

product.forEach((check) => {
  check.addEventListener("click", (e) => {
    const product_id = e.currentTarget.dataset.remove;
    console.log(product_id);

    localStorage.setItem("products_id", JSON.stringify(product_id));

      const id = JSON.parse(localStorage.getItem("products_id"));
      console.log(id);

      const user_id = JSON.parse(localStorage.getItem("uniqueID"));

      const all_products = JSON.parse(localStorage.getItem("cart"));

      const pdts = all_products.find(
        (g) => g.product_id === id && g.buyer_id === user_id
      );

      const indexOfProduct = all_products.indexOf(pdts);

      const wish_products = JSON.parse(localStorage.getItem("wish")) || [];

      const check_wish = wish_products.find((o) => o.product_id === id);

      if(check_wish) {

        alert("You already added this product to your wishlist.")

      } else {

        if (window.confirm ("Are you sure to move this product to wishlist ?")) {

          all_products.splice(indexOfProduct, 1);

          wish_products.push(pdts);

          localStorage.setItem("wish", JSON.stringify(wish_products));

          localStorage.setItem("cart", JSON.stringify(all_products));

          window.location.reload();

        }

      }
    
    });
});

// BUY NOW 

document.querySelector("button.buy").addEventListener("click",() => {
  window.location.href = "../orders/cart-buynowpage.html";
} )
</script>

    </body>
</html>   