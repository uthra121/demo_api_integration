<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Product detail page </title>
  <link rel="stylesheet" href="../../../assets/css/style-saree1view.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
    integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
    crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Kreon:wght@300;400;500;600;700&family=Kumbh+Sans:wght@100;200;300;400;500;600;700;800;900&family=Parisienne&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
    rel="stylesheet">
</head>

<body>
  <header id="userLogin">

  </header>
  <section>

    <div class="arrows"> </div>

    <div class="detail">
    </div>

  </section>

  <h5 class="rev"> REVIEWS : </h5>

  <button class="rev_b"> ADD REVIEWS </button>

  <div class="rev_sec">

    <!-- <div class="reviews">
        <div class="rname"> 
          <img src="../../../assets/images/avatar.jpg" alt="pic" height="50px" width="50px">
          <p id="uname"> Uthra B </p>
        </div>
        <p class="com"> Comments : </p>  
        <p id="reviews"> Good dress.... Very comfortable </p>  
      </div> -->

  </div>

  <div class="left-b"> </div>
  <h6> SIMILAR PRODUCTS </h6>

  <div class="right-b"> </div>

  <div class="thumbnail"> </div>

  <footer>
    <div class="top">
      <div class="about">
        <h4> About: </h4>
        <div class="us">
          <p>
            <a href="../../../homepage/aboutus.html"> About us </a>
          </p>
          <p>
            <a href="../../../homepage/frontpage.html"> Available Products </a>
          </p>
          <p>
            <a href="../../../homepage/termsofuse.html"> Terms of use </a>
          </p>
          <p>
            <a href="../../../homepage/return.html"> Return policy </a>
          </p>
        </div>
      </div>

      <div class="line"></div>

      <div class="contact">

        <div class="socials">
          <span class="con"> Contact us </span>
          <div class="insta">
            <i class="fa-brands fa-instagram" style="font-size:23px"></i>
          </div>
          <div class="fb">
            <i class="fa-brands fa-facebook-f" style="font-size:23px"></i>
          </div>
          <div class="twiter">
            <i class="fa-brands fa-twitter" style="font-size:23px"></i>
          </div>
          <div class="wa">
            <i class="fa-brands fa-whatsapp" style="font-size:23px"></i>
          </div>
        </div>
        <div>
          <p>Copy rights @ 2022</p>
        </div>
      </div>
    </div>

  </footer>

  <script src="../../../../assets/js/header.js"></script>

  <script>
    const add_product = JSON.parse(localStorage.getItem("product_details"));

    // to set the location to the variable queryString

    const queryString = window.location.search;

    // to get the location

    const urlParams = new URLSearchParams(queryString);

    // to show the name as what we have to show

    const product_id = urlParams.get("product_id");

    // checking from the array and getting the particular id

    const unique_id = add_product.find((e) => e.product_uuid === product_id);
    console.log(unique_id)

    const size_list = JSON.parse(localStorage.getItem("product_size_details")).filter((o) => o.product_uuid === unique_id.product_uuid)
    console.log(size_list);
    // console.log(unique_id);

    // <div class = "arrow" > </div>

    const div_arrow = document.createElement("div");
    div_arrow.setAttribute("class", "arrow");
    // console.log(div_arrow);

    // <a> link </a>

    const a_arrow = document.createElement("a");
    a_arrow.setAttribute("href", "../../homepage/frontpage.html");
    div_arrow.append(a_arrow);
    // console.log(a_arrow);

    // < i >  arrow </i>

    const i_arrow = document.createElement("i");
    i_arrow.setAttribute("class", "fa-solid fa-arrow-left");
    a_arrow.append(i_arrow);

    // <div class = "left" > </div>

    const div_left = document.createElement("div");
    div_left.setAttribute("class", "left");

    // <div class = "image" > </div>

    const div_image = document.createElement("div");
    div_image.setAttribute("class", "image");
    div_left.append(div_image);

    // <img />

    const img = document.createElement("img");
    img.setAttribute("src", unique_id.image);
    img.setAttribute("alt", `${unique_id.name}image`);
    img.setAttribute("height", "460px");
    img.setAttribute("width", "400px");
    div_image.append(img);

    // <div class = "right" > </div>

    const div_right = document.createElement("div");
    div_right.setAttribute("class", "right");

    // <h3> </h3>

    const h3 = document.createElement("h3");
    h3.setAttribute("id", "name");
    h3.innerText = unique_id.name;
    div_right.append(h3);

    // <h4> </h4>

    const h4 = document.createElement("h4");
    h4.innerText = "Special price";
    div_right.append(h4);

    // <div class = "price" > </div>

    const div_price = document.createElement("div");
    div_price.setAttribute("class", "price");
    div_right.append(div_price);

    // < p id = "original_price" > </p>

    const p_org = document.createElement("p");
    p_org.setAttribute("id", "original_price");
    p_org.innerText = `₹${size_list[0].discount_price}  `;
    div_price.append(p_org);

    // <p> </p>

    const p_dis = document.createElement("p");
    div_price.append(p_dis);

    // <s> </s>

    const s = document.createElement("s");
    s.setAttribute("id", "discount_price");
    s.innerText = `₹${size_list[0].original_price}`;
    p_dis.append(s);

    // <p> </p>

    const p_percent = document.createElement("p");
    div_price.append(p_percent);

    // < b > </b>

    const b = document.createElement("b");
    b.setAttribute("id", "discount_percent");
    b.innerText = `${size_list[0].discount_percent}% off`;
    p_percent.append(b);

    // <div class = "star"> </div>

    const div_star = document.createElement("div");
    div_star.setAttribute("class", "star");
    div_right.append(div_star);

    // <span> </span>

    const span = document.createElement("span");
    span.setAttribute("class", "stars");
    span.innerText = "Sizes :";
    div_star.append(span);


    if (size_list[0].size === "0" || size_list[0].size === "1" || size_list[0].size === "2" ||
      size_list[0].size === "3" || size_list[0].size === "4" || size_list[0].size === "5" ||
      size_list[0].size === "6" || size_list[0].size === "7") {

      div_star.setAttribute("style", "display: none;")

    }

    else {

      div_star.setAttribute("style", "display: flex;")

    }

    for (let j = 0; j < size_list.length; j++) {
      const p_size = document.createElement("button");
      p_size.setAttribute("class", "size");
      p_size.setAttribute("data-size", size_list[j].size);
      p_size.innerHTML = size_list[j].size;
      div_star.append(p_size);
    }

    // < strong> </strong>

    const strong_pdt = document.createElement("strong");
    strong_pdt.innerText = "Product details:";
    div_right.append(strong_pdt);

    // <div class = "para"> </div>

    const div_pdt = document.createElement("div");
    div_pdt.setAttribute("class", "para");
    div_right.append(div_pdt);

    // <p> </p>

    const p_pdt = document.createElement("p");
    p_pdt.setAttribute("id", "product_detail");
    p_pdt.innerText = unique_id.product_detail;
    div_pdt.append(p_pdt);

    // < strong> </strong>

    const strong_add = document.createElement("strong");
    strong_add.setAttribute("class", "paras");
    strong_add.innerText = "Additional offers";
    div_right.append(strong_add);

    // <div class = "para"> </div>

    const div_add = document.createElement("div");
    div_add.setAttribute("class", "paras");
    div_right.append(div_add);

    // <p> </p>

    const p_add = document.createElement("p");
    p_add.setAttribute("id", "add_info");
    p_add.innerText = unique_id.add_info;
    div_add.append(p_add);

    // <button class="add">

    const button_add = document.createElement("button");
    button_add.setAttribute("class", "add");
    button_add.setAttribute("data-add", unique_id.product_uuid);
    button_add.innerText = "ADD TO CART";
    div_right.append(button_add);

    // <i> == cart

    const i_cart = document.createElement("i");
    i_cart.setAttribute("class", "fa fa-shopping-cart");
    i_cart.setAttribute("style", "font-size:24px;color: white;");
    button_add.append(i_cart);

    // <button class="buy">

    const button_buy = document.createElement("button");
    button_buy.setAttribute("class", "buy");
    button_buy.innerText = "BUY NOW";
    div_right.append(button_buy);

    // <i> == cart

    const i_buy = document.createElement("i");
    i_buy.setAttribute("class", "fa fa-shopping-bag");
    i_buy.setAttribute("style", "font-size:24px;color: white;");
    button_buy.append(i_buy);

    // <button class="wish">

    const button_wish = document.createElement("button");
    button_wish.setAttribute("class", "wish");
    button_wish.innerText = "WISHLIST";
    div_right.append(button_wish);

    // <i> == cart

    const i_wish = document.createElement("i");
    i_wish.setAttribute("class", "fa fa-heart");
    i_wish.setAttribute("style", "font-size:24px;color: white;");
    button_wish.append(i_wish);

    document.querySelector("div.arrows").append(div_arrow);
    document.querySelector("div.detail").append(div_left);
    document.querySelector("div.detail").append(div_right);


    // WISHLIST function

    const wish_products = document.querySelector("button.wish");

    wish_products.addEventListener("click", () => {
      const user_id = JSON.parse(localStorage.getItem("uniqueID"));

      const user_data = JSON.parse(localStorage.getItem("user_cred"));

      const check = user_data.find((e) => e.phonenumber === user_id);

      if (!check) {
        alert("You are not logged in.");
      } else {
        const id = JSON.parse(localStorage.getItem("productDetail"));

        // console.log(id);

        const all_products = JSON.parse(localStorage.getItem("product_details"));

        // console.log(all_products);

        const products = all_products.find((e) => e.product_uuid === id);
        // console.log(products);

        const wishlist = JSON.parse(localStorage.getItem("wish")) || [];
        // console.log(wishlist);

        const exist =
          wishlist.length &&
          JSON.parse(localStorage.getItem("wish")).some(
            (o) => o.product_id === id && o.buyer_id === user_id
          );
        // console.log(exist);

        if (exist) {
          alert("This product has already been added");
        } else {
          alert("This product is added to your wishlist.");

          wishlist.push({
            product_quantity: 1,
            seller_id: products.user_id,
            buyer_id: user_id,
            product_id: products.product_uuid,
            discount_price: size_list[0].discount_price,
          });

          localStorage.setItem("wish", JSON.stringify(wishlist));

        }
      }
    });

    // BUY NOW

    const buy_now = document.querySelector("button.buy");

    buy_now.addEventListener("click", () => {
      const user_id = JSON.parse(localStorage.getItem("uniqueID"));

      const users = JSON.parse(localStorage.getItem("user_cred"));

      const productDetail = JSON.parse(localStorage.getItem("productDetail"));

      const checking = users.find((e) => e.phonenumber === user_id);

      if (checking) {
        window.location.href = `../../orders/buynow.html?product_id=${productDetail}`;
      } else {
        alert("You are not logged in");
      }
    });


    /////    ADD  REVIEWS     /////

    const review = document.querySelector("button.rev_b");

    review.addEventListener("click", () => {
      const user_id = JSON.parse(localStorage.getItem("uniqueID"));

      const users = JSON.parse(localStorage.getItem("user_cred"));

      const productDetail = JSON.parse(localStorage.getItem("productDetail"));

      const checking = users.find((e) => e.phonenumber === user_id);

      if (checking) {
        window.location.href = `../../homepage/reviewform.html?product_id=${productDetail}`;
      } else {
        alert("You are not logged in");
      }
    });

    const reviews_list = JSON.parse(localStorage.getItem("reviews"));

    const reviews = reviews_list.filter((p) => p.product_id === product_id);

    for (let r = 0; r < reviews.length; r++) {

      const div_reviews = document.createElement("div");
      div_reviews.setAttribute("class", "reviews");
      document.querySelector("div.rev_sec").append(div_reviews);

      const div_name = document.createElement("div");
      div_name.setAttribute("class", "rname");
      div_reviews.append(div_name);

      const p_img = document.createElement("img");
      p_img.setAttribute("src", "../../../assets/images/avatar.jpg");
      p_img.setAttribute("alt", "profile");
      p_img.setAttribute("height", "50px");
      p_img.setAttribute("width", "50px");
      div_name.append(p_img);

      const p_n = document.createElement("p");
      p_n.setAttribute("id", "uname");
      p_n.innerHTML = reviews[r].uname;
      div_name.append(p_n);

      const p_com = document.createElement("p");
      p_com.setAttribute("class", "com");
      p_com.innerHTML = "Comments :";
      div_reviews.append(p_com);

      const p_r = document.createElement("p");
      p_r.innerHTML = reviews[r].review;
      div_reviews.append(p_r);

      div_rate = document.createElement("div");
      div_rate.setAttribute("class", "stars_r");
      div_reviews.append(div_rate);

      for (let j = 1; j <= 5; j++) {
        const star = document.createElement("span");
        star.innerHTML = j <= reviews[r].rating ? "&#9733;" : "&#9734;";
        star.style.color = j <= reviews[r].rating ? "#FFA500" : "";
        div_rate.append(star);
      }

    }


    /////     PRICE CHANGING ACCORDING TO SIZE   //////


    document.querySelectorAll('.size').forEach((element) => {
      element.addEventListener('click', (event) => {
        const size_id = event.currentTarget.getAttribute('data-size');
      console.log(size_id);

      let sizePrice = size_list.find((s) => s.size === size_id);
      s.innerText = `₹${sizePrice.original_price}`;
      b.innerText = `${sizePrice.discount_percent}% off`;    
      p_org.innerText = `₹${sizePrice.discount_price} `; 
     });
    });



        // ADD TO CART function

        const cart_products = document.querySelector("button.add");

cart_products.addEventListener("click", () => {
  const uniqueid = JSON.parse(localStorage.getItem("uniqueID"));
  // console.log(unique_id);

  const user_data = JSON.parse(localStorage.getItem("user_cred"));
  // console.log(user_data);

  const users =
    user_data.length &&
    JSON.parse(localStorage.getItem("user_cred")).some(
      (data) => data.phonenumber === uniqueid
    );
  // console.log(users);

  if (!users) {
    alert("You are not logged in. Please login to continue");
  } else {
    const id = JSON.parse(localStorage.getItem("productDetail"));

    // console.log(id);

    const all_products = JSON.parse(localStorage.getItem("product_details"));

    // console.log(all_products);

    const products = all_products.find((e) => e.product_uuid === id);
    console.log(products);

    const add_to_cart = JSON.parse(localStorage.getItem("cart")) || [];
    // console.log(add_to_cart);

    const pdt_price = document.getElementById("original_price").innerText;

const parts = pdt_price.match(/(\D+)(\d+)/);

const symbol = parts[1];
const number = parseInt(parts[2]);

console.log(number);

const size_detail = JSON.parse(localStorage.getItem("product_size_details"));

const check_size = size_detail.find((o) => o.product_uuid === id && o.discount_price === number);
console.log(check_size);

    const exist =
      add_to_cart.length &&
      JSON.parse(localStorage.getItem("cart")).some(
        (data) => data.product_id === id && data.buyer_id === uniqueid && data.size === check_size.size
      );
    // console.log(exist);

    if (exist) {
      alert("This product has already been added");
    } else {

      alert("This product is added to your cart.");

      add_to_cart.push({
        product_quantity: 1,
        seller_id: products.user_id,
        buyer_id: uniqueid,
        product_id: check_size.product_uuid,
        discount_price: check_size.discount_price,
        size: check_size.size
      });

      const cart_count = add_to_cart.filter((pdt) => pdt.buyer_id === uniqueid).length
      console.log(cart_count);

      localStorage.setItem("cart_count", JSON.stringify(cart_count));

      localStorage.setItem("cart", JSON.stringify(add_to_cart));

      window.location.reload();

    }
  }
});




    // SIMILAR PRODUCTS ////

    const pdt_len = 4;

    for (let k=0; k<pdt_len; k++ ) {

      const div_products = document.createElement("div");
      div_products.setAttribute("class", "products");
      div_products.setAttribute("data-id", add_product[k].product_uuid);
      console.log(div_products);

      // <img>

      const image = document.createElement("img");
      image.setAttribute("src", add_product[k].image);
      image.setAttribute("alt", "photo");
      image.setAttribute("height", "200px");
      image.setAttribute("width", "200px");
      div_products.append(image);

      // <h3> </h3>

      const h3_title = document.createElement("h5");
      // h3_title.setAttribute("class", "name");
      h3_title.innerText = add_product[k].name;
      div_products.append(h3_title);

      // <p> </p>

      const p_org_p = document.createElement("p");
      p_org_p.setAttribute("class", "price");
      p_org_p.innerText = `₹${size_list[0].discount_price} `;
      div_products.append(p_org_p);

      // <p> </p>

      // p_dis = document.createElement("p");
      // h3_title.append(p_dis);

      // <s> </s>

      const strike = document.createElement("s");
      strike.setAttribute("class", "dis_price");
      strike.innerText = `₹${size_list[0].original_price}  `;
      p_org_p.append(strike);

      // <span> </span>

      const span_per = document.createElement("span");
      span_per.setAttribute("class", "per");
      span_per.innerText = ` ${  size_list[0].discount_percent}% off`;
      p_org_p.append(span_per);

      document.querySelector("div.thumbnail").append(div_products);

    }


  </script>

</body>

</html>